\documentclass{jarticle}
\title{英語でコミットメッセージを書こう\\ver 1.0}
\author{同人サークル NP-complete}
\date{}
\renewcommand\thefootnote{[\arabic{footnote}]}
\usepackage{ascmac}
\usepackage{fancybox}
\begin{document}
\maketitle
\newpage

{\bf {\Large ``} }
{\it GIANT BUG... causing /usr to be deleted... so sorry....
 issue \#123, issue \#122, issue \#121}
{\bf {\Large ''} }
\begin{flushright}
 -- MrMEEE\footnote{https://github.com/MrMEEE/bumblebee/commit/a047be85247755cdbe0acce6}
\end{flushright}

\vspace{1in}

{\tt
\begin{verbatim}
@@ -348,7 +348,7 @@ case ``$DISTRO'' in
   ln -s /usr/lib/mesa/ld.so.conf /etc/alternatives/gl_conf
   rm -rf /etc/alternatives/xorg_extra_modules
   rm -rf /etc/alternatives/xorg_extra_modules-bumblebee
-  rm -rf /usr /lib/nvidia-current/xorg/xorg
+  rm -rf /usr/lib/nvidia-current/xorg/xorg
   ln -s /usr/lib/nvidia-current/xorg
 /etc/alternatives/xorg_extra_modules-bumblebee
   ldconfig
  ;;

\end{verbatim}
}

\newpage
\section{まえがき}
みなさん、github\footnote{https://github.com}使ってますか?
もちろん使ってますよね!
githubでコードを公開した瞬間から、あなたはオープンソースのプログラマです。

世界中の誰もがあなたのコードにアクセスすることができます。
全然知らない国の人があなたのコードに改良を加えて、
pull requestしてくれるかもしれません。

あなたがコミットメッセージを英語で書いてさえすればね!!!

\subsection{英語でコミットメッセージを書こう}
英語でコミットメッセージを書こうっていきなり言われても困りますよね。
多分技術者なら読む方はある程度できると思います。
たくさん英語のドキュメント読んでますよね?

書く方なんてやったこと無いよって思い込んでませんか?
実はほとんどの人が英語に近い文章を日々たくさん書いているはずです。
そうです、コードです。

\subsection{なぜコードは英語で書けるのか}
言語を覚えたりコードを書く際には言語のドキュメントや他の人が書いたコード
を大量に読みます。
コードを大量に読めば、自然とその言語の標準的な命名ルールや、
定番の変数名に気づくことになるでしょう。

多くの人は、他人のコードを読むことで自然と覚えた英単語を組み合わせ、
自分のコードを書いているのではないでしょうか?
ドキュメントを読むことよりも、求められる英語力は低いのではないかと思いま
す。
\subsection{同じことをコミットメッセージにも}
同様にコミットメッセージも、標準的な単語や、
定番の言い回しなどを列挙さえすれば、
必要十分なコミットメッセージは簡単に書けるようになりそうです。

この本の目的は、そのような定番を見つけ出し、
簡単に英語でコミットメッセージを書けるような材料を揃えることです。
そして日本人のプロダクトに言語の壁と国境をなくすことです。

\newpage
\section{調査方法}
リポジトリの調査に使ったスクリプトは全て公開
\footnote{https://github.com/np-complete/c81}しています。
まずこのリポジトリをチェックアウトしましょう。
実際にあなたの好きなプロジェクトを選んで同じ調査を実行することができます。

次に、githubで調査対象にしたいリポジトリを探し、
{\tt src } ディレクトリにチェックアウトしておきます。
もちろんコミットメッセージが英語で書かれているものですが、
英語ネイティブ/非ネイティブ両方を調べたほうがいいかもしれません。
もちろん、自分が興味を持てるプロジェクトを最優先したほうがいいでしょう。

今回、
git\footnote{https://github.com/git/git},
linux\footnote{https://github.com/torvalds/linux},
ruby\footnote{https://github.com/ruby/ruby},
rails\footnote{https://github.com/rails/rails},
jquery\footnote{https://github.com/jquery/jquery},
node\footnote{https://github.com/joyent/node}
などを調査対象にしました。

また、git以外のリポジトリでも、
コミットメッセージさえ取得できれば同じスクリプトで調査ができるはずです。

\section{単語を調べる}
まず最初にどのような単語がよく使われているかを把握しましょう。

gitでは、
\begin{quote}
{\tt \$git log --pretty=\%s\%n\%b\%n}
\end{quote}

というコマンドでコミットメッセージ部分だけ見ることができます。

このスクリプトを {\tt c81/bin/only-message } に置いてあります。
次のようにファイルに保存しておくとよいでしょう。
\begin{quote}
{\tt \$cd src/rails; ../bin/only-message > ../data/rails-messages }
\end{quote}

メッセージから余分な文字や記号を削除して、
単語に分割しやすくするスクリプトが {\tt c81/bin/word-format} です。
先程の出力をこのスクリプトに通しておきましょう。
\begin{quote}
{\tt \$./bin/word-format ./data/rails-messages > ./data/rails-words }
\end{quote}

これで素のコミットメッセージが単語に分割しやすい形になりました。


  \subsection{文頭の単語を調べる}
  英語の文章は一番言いたいことを先に書くっていうルールがあります。
  とりあえず文頭の単語を調べてみましょう!
  \begin{quote}
   {\tt \$./bin/first-word ./data/rails-words | ./bin/counter > ./data/rails-first-word}
  \end{quote}


  \begin{table}[htbp]
   \begin{center}
    \begin{tabular}{c}

     \begin{minipage}{0.3\hsize}
      \begin{center}
       \caption{rails の場合}
       \begin{tabular}{c|c}
        \hline
        1670 & fix \\
        1519 & merge \\
        1369 & added \\
        1274 & add \\
        1030 & fixed \\
        843 & remove \\
        683 & make \\
        632 & use \\
        532 & this \\
        456 & update \\
        339 & ensure \\
        324 & revert \\
        311 & move \\
        303 & don \\
        282 & allow \\
        225 & removed \\
        \hline
       \end{tabular}
      \end{center}
     \end{minipage}

     \begin{minipage}{0.3\hsize}
      \begin{center}
       \caption{node の場合}
       \begin{tabular}{c|c}
        \hline
        513 & add \\
        485 & fix \\
        216 & upgrade \\
        205 & remove \\
        201 & this \\
        178 & fixes \\
        99 & http \\
        96 & use \\
        90 & the \\
        89 & - \\
        84 & bump \\
        82 & closes \\
        76 & merge \\
        66 & revert \\
        62 & make \\
        61 & update \\
        \hline
       \end{tabular}
      \end{center}
     \end{minipage}


     \begin{minipage}{0.3\hsize}
      \begin{center}
       \caption{jquery の場合}
       \begin{tabular}{c|c}
        \hline
        366 & added \\
        295 & fixed \\
        251 & fix \\
        192 & merge \\
        189 & jquery \\
        180 & make \\
        93 & fixes \\
        77 & removed \\
        67 & - \\
        65 & made \\
        56 & add \\
        51 & tagging \\
        49 & updating \\
        46 & landing \\
        43 & more \\
        41 & updated \\
        \hline
       \end{tabular}
      \end{center}
     \end{minipage}

    \end{tabular}
   \end{center}
  \end{table}

  ほとんどが動詞ですね!
  さらに3つのプロジェクトで共通して出てくる単語がいくつかあります。
  {\bf fix}, {\bf add}, {\bf remove}, {\bf make}, {\bf update} です。
  これらの単語は異常によく使われる単語だというのがわかりますね。

   \subsubsection{文脈を確認する}

   {\bf make} と {\bf update} は少し意味が分かりづらいので文脈を確認します。
   {\tt c81/bin/grep-first}スクリプトを使い、{\tt grep} で頭文字が一致する文を抜き出しましょう。

   \begin{quote}
    {\tt \$./bin/grep-first make ./data/rails-words }
   \end{quote}

   例えばこんな文章が出てきます。
   \begin{quote}
    {\bf make} all tests pass on pgsql \#1759 rick olson\\
    {\bf make} sure that we get back a soapstring when \$kcode is utf-8\\
    {\bf make} request\#subdomains handle foo foo com correctly\\
   \end{quote}
   どうやらナニナニをチョメチョメな状態にするという意味のようです。

   同様にupdateも調べてみました。
   どうやらupdateは
   {\bf makeと同じような使い方{\footnote{例) update jquery data to use jquery noop for tojson hack instead of an additional superfluous function}}} や
   {\bf 関連ライブラリをupdateした{\footnote{例) update to prototype 1 5
   0 }}} など様々な意味で使われているようでした。
   {\bf make} と {\bf update} の微妙なニュアンスの違いはよく分かりません。

  \subsubsection{まとめ}
  自分がやったことを表現するには次の単語を文頭に使うと良い。
  \begin{table}[htbp]
   \begin{center}
    \begin{tabular}{ll}
     fix & バグを修正した \\
     add & 機能やファイルを追加した \\
     remove & 機能やファイルを削除した \\
     make & 変更した(動作が明確に変わるとき) \\
     update & 更新した(外部ライブラリやドキュメント) \\
    \end{tabular}
   \end{center}
  \end{table}

  削除や変更という単語で、一番最初に思い浮かびそうな {\bf delete} や {\bf change} は、
  実はあまり使われていない。

 \subsection{全ての単語を調べる}
\end{document}
